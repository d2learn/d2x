export module d2x.console;

import std;

namespace d2x {
export namespace console {

void print(
    std::string target, std::vector<std::string> target_files,
    int built_targets, int total_targets,
    std::string output, bool status
) {

    // clear screen
    std::system("clear");

    // ğŸŒProgress: [====>------] x/y
    // x == built targets, current progress
    // y == total targets
    auto progress_bar = ">"
        + std::string(total_targets - built_targets - 1, '-');

    if (built_targets > 0) {
        progress_bar = std::string(built_targets, '=') + progress_bar;
    }

    progress_bar = std::string("\033[32m") + progress_bar + std::string("\033[0m");

    // Status
    auto status_str = status ? "âœ… Ok: Compilation/Running succeeded" : "âŒ Error: Compilation/Running failed";

    // target file (relative path)
    std::string target_file = target_files.empty() ? "N/A" : target_files[0];
    std::string current_path = std::filesystem::current_path().string();
    if (target_file.find(current_path) == 0) {
        target_file = target_file.substr(current_path.length() + 1);
    }

    // layout
    std::println("ğŸŒProgress: [{}] {}/{}", progress_bar, built_targets, total_targets);
    std::println();    
    std::println("ğŸ¯ [Target: {}] ğŸ¯", target);
    std::println("");
    std::println("{} for {}", status_str, target_file);

    std::println("");

    if (status) {
        std::println("\tğŸ‰   The code is compiling!   ğŸ‰");
    } else {
        std::println("\t   The code exist some error!");
    }

    std::println("\n---\n");
    std::println("{}", output);
    std::println("---\n");

    std::println("d2x: https://github.com/d2learn/d2x");
}

} // namespace console
} // namespace d2x